<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Diário de Viagens — Modern</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* customizações para um visual mais profissional */
    input:focus, textarea:focus, select:focus { outline: none; }
    .card { box-shadow: 0 8px 20px rgba(2,6,23,0.08); }
    /* slider styling fallback */
    input[type=range] { accent-color: #6366f1; }
  </style>
</head>
<body class="bg-gradient-to-b from-slate-50 via-white to-slate-50 min-h-screen text-slate-800">
  <header class="bg-white/80 backdrop-blur sticky top-0 z-20 border-b">
    <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 bg-gradient-to-br from-indigo-600 to-emerald-500 rounded-xl flex items-center justify-center text-white font-bold shadow-lg">DV</div>
        <div>
          <h1 class="text-xl font-semibold leading-none">Diário de Viagens</h1>
          <p class="text-sm text-slate-500">Registre suas memórias — simples, rápido e seguro no navegador.</p>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <button id="btn-citacao" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-indigo-600 text-white shadow hover:bg-indigo-700"> 
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 21H7a4 4 0 0 1-4-4V7a4 4 0 0 1 4-4h2" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 17h6l4 4V7a4 4 0 0 0-4-4h-2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          Citação do Dia
        </button>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto p-6 grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- Form (aside) -->
    <aside class="col-span-1">
      <form id="formEntrada" novalidate class="card bg-white rounded-2xl p-6 space-y-4">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold">Nova Memória</h2>
          <small class="text-xs text-slate-400">Campos com * são obrigatórios</small>
        </div>

        <div class="grid grid-cols-1 gap-3">
          <label class="block">
            <span class="text-xs text-slate-600 uppercase">Título do Local *</span>
            <input type="text" id="titulo" name="titulo" required class="mt-1 block w-full rounded-lg border border-slate-200 p-3 shadow-sm focus:ring-2 focus:ring-indigo-200" placeholder="Ex: Praia do Campeche" />
          </label>

          <div class="grid grid-cols-2 gap-3">
            <label class="block">
              <span class="text-xs text-slate-600 uppercase">Data da Visita *</span>
              <input type="date" id="data" name="data" required class="mt-1 block w-full rounded-lg border border-slate-200 p-3 shadow-sm focus:ring-2 focus:ring-indigo-200" />
            </label>

            <label class="block">
              <span class="text-xs text-slate-600 uppercase">Avaliação</span>
              <div class="mt-1 flex items-center gap-3">
                <input type="range" id="avaliacao" name="avaliacao" min="1" max="5" value="4" class="w-full" />
                <output id="avalOutput" class="w-8 text-right text-sm">4</output>
              </div>
            </label>
          </div>

          <label class="block">
            <span class="text-xs text-slate-600 uppercase">Link para uma foto (opcional)</span>
            <input type="url" id="foto" name="foto" placeholder="https://exemplo.com/foto.jpg" class="mt-1 block w-full rounded-lg border border-slate-200 p-3 shadow-sm focus:ring-2 focus:ring-indigo-200" />
          </label>

          <label class="block">
            <span class="text-xs text-slate-600 uppercase">Descrição *</span>
            <textarea id="descricao" name="descricao" minlength="15" required rows="4" class="mt-1 block w-full rounded-lg border border-slate-200 p-3 shadow-sm focus:ring-2 focus:ring-indigo-200" placeholder="Conte sobre sua experiência (mín. 15 caracteres)"></textarea>
          </label>

          <!-- Hidden fields para coordenadas -->
          <input type="hidden" id="lat" name="lat" />
          <input type="hidden" id="lng" name="lng" />

          <div class="flex gap-3">
            <button type="button" id="btnGeo" class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg border bg-emerald-600 text-white shadow hover:bg-emerald-700"> 
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 11c1.657 0 3-1.343 3-3S13.657 5 12 5 9 6.343 9 8s1.343 3 3 3z"/><path stroke-linecap="round" stroke-linejoin="round" d="M12 2v2m0 16v2m8-8h-2M4 12H2m15.364-6.364l-1.414 1.414M7.05 16.95l-1.414 1.414M16.95 16.95l1.414 1.414M7.05 7.05L5.636 5.636"/></svg>
              Adicionar Localização
            </button>

            <button type="submit" class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-gradient-to-r from-indigo-600 to-indigo-500 text-white shadow hover:from-indigo-700"> 
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 5v14M5 12h14" stroke-linecap="round" stroke-linejoin="round"/></svg>
              Salvar Memória
            </button>
          </div>

          <p id="msgGeo" class="text-sm text-slate-500"></p>
        </div>

        <footer class="pt-3 border-t mt-2 text-xs text-slate-400">Seu nome • <span id="ano"></span></footer>
      </form>
    </aside>

    <!-- Entradas (section) -->
    <section id="entradas" class="col-span-2 space-y-4">
      <div id="vazio" class="text-center text-slate-500 p-8 bg-white rounded-2xl card">Nenhuma memória ainda. Use o formulário para adicionar.</div>
    </section>
  </main>

  <!-- Local onde a citação aparecerá -->
  <div class="max-w-6xl mx-auto p-6">
    <div id="citacaoArea" class="bg-white p-6 rounded-2xl card hidden">
      <div class="flex items-start gap-4">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-6a4 4 0 0 1 4-4h1"/></svg>
        <div class="flex-1">
          <blockquote id="citacaoTexto" class="italic text-lg text-slate-700"></blockquote>
          <p id="citacaoAutor" class="text-right mt-3 text-sm text-slate-500"></p>
        </div>
      </div>
      <p id="citacaoAviso" class="mt-3 text-xs text-amber-600 hidden"></p>
    </div>
  </div>

  <script>
    // --- Configurações iniciais ---
    document.getElementById('ano').textContent = new Date().getFullYear();
    const storageKey = 'diarioEntradas';

    // Range output
    const aval = document.getElementById('avaliacao');
    const avalOut = document.getElementById('avalOutput');
    aval.addEventListener('input', () => { avalOut.textContent = aval.value; });

    // Geolocation
    const btnGeo = document.getElementById('btnGeo');
    const msgGeo = document.getElementById('msgGeo');
    btnGeo.addEventListener('click', () => {
      msgGeo.textContent = 'Obtendo localização...';
      if (!navigator.geolocation) {
        msgGeo.textContent = 'Geolocation não suportada neste navegador.';
        return;
      }
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude.toFixed(6);
        const lng = pos.coords.longitude.toFixed(6);
        document.getElementById('lat').value = lat;
        document.getElementById('lng').value = lng;
        msgGeo.textContent = `Localização salva: ${lat}, ${lng}`;
      }, err => {
        msgGeo.textContent = 'Falha ao obter localização: ' + (err.message || err.code);
      }, { enableHighAccuracy: true, timeout: 10000 });
    });

    // localStorage helpers
    function lerEntradas(){
      const raw = localStorage.getItem(storageKey);
      try{ return raw ? JSON.parse(raw) : []; }catch(e){ console.error('Erro parse localStorage', e); return []; }
    }
    function salvarEntradas(arr){ localStorage.setItem(storageKey, JSON.stringify(arr)); }

    // render
   function renderEntradas(){
  const container = document.getElementById('entradas');
  container.innerHTML = '';
  const entradas = lerEntradas();

  if(!entradas.length){
    const vazio = document.createElement('div');
    vazio.id = 'vazio';
    vazio.className = 'text-center text-slate-500 p-8 bg-white rounded-2xl card';
    vazio.textContent = 'Nenhuma memória ainda. Use o formulário para adicionar.';
    container.appendChild(vazio);
    return;
  }

  entradas.forEach(e => {
    const article = document.createElement('article');
    article.className = 'bg-white p-4 rounded-2xl card flex gap-4 items-start';

    const mainDiv = document.createElement('div');
    mainDiv.className = 'flex-1';

    const header = document.createElement('div');
    header.className = 'flex items-baseline justify-between gap-2';
    const h3 = document.createElement('h3');
    h3.className = 'font-semibold text-lg';
    h3.textContent = e.titulo;

    const small = document.createElement('small');
    small.className = 'text-sm text-slate-400';
    small.textContent = new Date(e.data).toLocaleDateString();

    header.appendChild(h3);
    header.appendChild(small);

    const p = document.createElement('p');
    p.className = 'mt-2 text-sm text-slate-600';
    p.textContent = e.descricao;

    const meta = document.createElement('div');
    meta.className = 'mt-3 text-sm text-slate-500';
    meta.innerHTML = `Avaliação: <strong class="text-indigo-600">${e.avaliacao}</strong>` +
      (e.lat && e.lng ? ` • Coordenadas: ${e.lat}, ${e.lng}` : '');

    mainDiv.appendChild(header);
    mainDiv.appendChild(p);
    mainDiv.appendChild(meta);

    // --- Figura sempre exibida ---
    const figure = document.createElement('figure');
    figure.className = 'w-40 flex-shrink-0 rounded overflow-hidden bg-slate-100';
    
    const img = document.createElement('img');
    img.src = e.foto || 'https://via.placeholder.com/150?text=Sem+Imagem';
    img.alt = e.titulo;
    img.className = 'object-cover h-28 w-full';
    img.onerror = () => { img.src = 'https://via.placeholder.com/150?text=Imagem+Indisponível'; };

    const figcap = document.createElement('figcaption');
    figcap.className = 'text-xs text-center mt-1 text-slate-400';
    figcap.textContent = `${e.titulo} — ${new Date(e.data).toLocaleDateString()}`;

    figure.appendChild(img);
    figure.appendChild(figcap);

    article.appendChild(figure);
    article.appendChild(mainDiv);

    const acoes = document.createElement('div');
    acoes.className = 'flex flex-col gap-2 items-end';
    
    const btnVer = document.createElement('button');
    btnVer.className = 'px-3 py-1 rounded-lg border text-sm';
    btnVer.textContent = 'Ver no mapa';
    btnVer.addEventListener('click', () => {
      if(e.lat && e.lng){
        window.open(`https://www.google.com/maps/search/?api=1&query=${e.lat},${e.lng}`, '_blank');
      } else alert('Esta entrada não tem coordenadas.');
    });

    const btnDel = document.createElement('button');
    btnDel.className = 'px-3 py-1 rounded-lg bg-red-600 text-white text-sm shadow';
    btnDel.textContent = 'Excluir';
    btnDel.addEventListener('click', () => {
      if(!confirm('Excluir esta memória?')) return;
      removerEntrada(e.id);
    });

    acoes.appendChild(btnVer);
    acoes.appendChild(btnDel);
    article.appendChild(acoes);

    container.appendChild(article);
  });
}

    function removerEntrada(id){
      const entradas = lerEntradas().filter(x => x.id !== id);
      salvarEntradas(entradas);
      renderEntradas();
    }

    // submit
    const form = document.getElementById('formEntrada');
    form.addEventListener('submit', (ev) =>{
      ev.preventDefault();
      const titulo = document.getElementById('titulo').value.trim();
      const data = document.getElementById('data').value;
      const foto = document.getElementById('foto').value.trim();
      const descricao = document.getElementById('descricao').value.trim();
      const avaliacao = document.getElementById('avaliacao').value;
      const lat = document.getElementById('lat').value;
      const lng = document.getElementById('lng').value;

      if(!titulo || !data || !descricao || descricao.length < 15){
        alert('Preencha corretamente os campos obrigatórios (descrição mínimo 15 caracteres).');
        return;
      }

      const nova = { id: Date.now(), titulo, data, foto: foto || null, descricao, avaliacao: Number(avaliacao), lat: lat || null, lng: lng || null };
      const entradas = lerEntradas();
      entradas.unshift(nova);
      salvarEntradas(entradas);

      form.reset();
      document.getElementById('avalOutput').textContent = '4';
      document.getElementById('msgGeo').textContent = '';

      renderEntradas();
    });

    // Citação do dia com fallback e timeout
    const btnCit = document.getElementById('btn-citacao');
    btnCit.addEventListener('click', fetchQuote);

    async function fetchQuote(){
      const area = document.getElementById('citacaoArea');
      const texto = document.getElementById('citacaoTexto');
      const autor = document.getElementById('citacaoAutor');
      const aviso = document.getElementById('citacaoAviso');

      area.classList.remove('hidden');
      aviso.classList.add('hidden');
      texto.textContent = '';
      autor.textContent = '';

      // feedback no botão
      btnCit.disabled = true;
      const originalLabel = btnCit.innerHTML;
      btnCit.innerHTML = '<svg class="h-4 w-4 animate-spin" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle></svg> Buscando...';

      const fallback = [
        {content: 'Viajar é investir em lembranças que valem mais que coisas.', author: 'Autor Desconhecido'},
        {content: 'A vida é curta e o mundo é grande — vá ver.', author: 'Desconhecido'},
        {content: 'Cada viagem revela uma nova peça de nós mesmos.', author: 'Reflexão'}
      ];

      try{
        // Se estiver aberto via file://, o fetch pode falhar por CORS. Tentar mesmo assim.
        const controller = new AbortController();
        const timeoutId = setTimeout(()=> controller.abort(), 10000);
        const res = await fetch('https://api.quotable.io/random', { signal: controller.signal });
        clearTimeout(timeoutId);
        if(!res.ok) throw new Error('Resposta não OK: ' + res.status);
        const j = await res.json();
        texto.textContent = j.content;
        autor.textContent = `— ${j.author}`;
      }catch(e){
        console.warn('Fetch da citação falhou, usando fallback.', e);
        const q = fallback[Math.floor(Math.random()*fallback.length)];
        texto.textContent = q.content;
        autor.textContent = `— ${q.author} (fonte local)`;
        // Se o usuário estiver abrindo direto do arquivo, informamos
        if(location.protocol === 'file:'){
          aviso.textContent = 'Observação: você abriu o HTML pelo protocolo file:// — requisições externas podem falhar. Use um servidor local (ex.: Live Server) para testar a API.';
          aviso.classList.remove('hidden');
        }
      }finally{
        btnCit.disabled = false;
        btnCit.innerHTML = originalLabel;
      }
    }

    // inicializar
    document.addEventListener('DOMContentLoaded', () => {
      renderEntradas();
    });
  </script>
</body>
</html>
